<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ポキモ ランキングボード</title>
<style>
  body { background:#111; color:#fff; font-family:sans-serif; }
  table { border-collapse: collapse; margin:20px auto; width:80%; }
  th, td { border:1px solid #555; padding:8px; text-align:center; }
  th { background:#333; }
</style>
</head>
<body>
<h1 style="text-align:center;">ポキモ 作業時間集計</h1>
<table id="rankingTable">
  <tr><th>担当</th><th>総ポキモ時間</th></tr>
</table>

<script>
async function fetchData() {
  const url = "https://docs.google.com/spreadsheets/d/1SJ7cK5g8Qv3ytS4L0dQkRGKktAu-twa8XOFiB0abrpo/gviz/tq?tqx=out:json&sheet=シート1";
  const res = await fetch(url);
  const text = await res.text();

  const json = JSON.parse(text.substr(47).slice(0, -2));
  const rows = json.table.rows;

  // 担当ごとに集計（分）
  let totals = {};
  rows.forEach(r => {
    let user = r.c[0]?.v || "";
    let minutes = Number(r.c[1]?.v) || 0; // 安全に数値化
    if (!totals[user]) totals[user] = 0;
    totals[user] += minutes;
  });

  // 配列化 & 時間換算
  let data = Object.keys(totals).map(user => {
    let totalMin = totals[user];
    let hours = Math.floor(totalMin / 60);
    let mins = totalMin % 60;
    let timeStr = hours > 0 
      ? (mins > 0 ? `${hours}時間${mins}分` : `${hours}時間`)
      : `${mins}分`;
    return { user, timeStr, totalMin };
  });

  // 総時間が多い順にソート
  data.sort((a,b)=> b.totalMin - a.totalMin);

  // テーブル反映
  const table = document.getElementById("rankingTable");
  data.forEach(d=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${d.user}</td><td>${d.timeStr}</td>`;
    table.appendChild(tr);
  });
}

fetchData();
</script>
</body>
</html>
